<!DOCTYPE html>
<html>
  <head>
    <script src="../dist/telepat.js"></script>
  </head>
  <body>
  <script>
    function statusChangeCallback(response) {
      if (response.status === 'connected') {
        Telepat.login(response.authResponse.accessToken);
      } else if (response.status === 'not_authorized') {
        document.getElementById('status').innerHTML = 'Please log into this app.';
      } else {
        document.getElementById('status').innerHTML = 'Please log into Facebook.';
      }
    }

    function checkLoginState() {
      FB.getLoginStatus(function(response) {
        statusChangeCallback(response);
      });
    }

    function addObject() {
      eventChannel.objects['new'] = {
        text: 'salut!'
      };
    }

    function removeObject() {
      delete eventChannel.objects['new'];
    }

    function subscribe() {
      eventChannel = Telepat.subscribe(Object.keys(Telepat.contexts)[0], 'event', function () {
        eventChannel.objects['1'].text = 'Text modificat';
        eventChannel.objects['1'].test = 'Da';
      });
    }

    var eventChannel;
    window.fbAsyncInit = function() {
        FB.init({
          appId      : '1086083914753251',
          xfbml      : true,
          version    : 'v2.3',
          status     : true
        });

        Telepat.setLogLevel('debug');

        Telepat.on('login', function () {
          console.log("logged in");
          subscribe();
        });

        Telepat.on('logout', function () {
          console.log("logged out");
        })

        Telepat.on('connect', function () {
          checkLoginState();
        });

        Telepat.on('contexts-update', function () {
          //Telepat.subscribe(Object.keys(Telepat.contexts)[0], 'event');
        });

        Telepat.connect({
          apiKey: '3406870085495689e34d878f09faf52c',
          appId: 1
        });
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
  </script>

  <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
  </fb:login-button>
  <br/>
  <button onclick="Telepat.logout()">Logout</button>
  <br/>
  <button onclick="subscribe()">Subscribe</button>
  <br/>
  <button onclick="eventChannel.unsubscribe()">Unsubscribe</button>
  <br/>
  <button onclick="addObject()">Add Object</button>
  <br/>
  <button onclick="removeObject()">Remove Object</button>

  <div id="status">
  </div>
  </body>
</html>